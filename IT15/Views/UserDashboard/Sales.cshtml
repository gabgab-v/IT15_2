@model IEnumerable<IT15.Models.StoreProduct>

@{
    ViewData["Title"] = "Record Sales";
    var currentBalance = (decimal)ViewData["CurrentBalance"];
    // This tells the view to use the UserDashboard layout
    Layout = "~/Views/UserDashboard/_Layout.cshtml";
}

<div class="flex justify-between items-center border-b border-gray-200 pb-4 mb-6">
    <div>
        <h2 class="text-2xl font-bold text-gray-900">Record Company Sales</h2>
        <p class="text-gray-500 mt-1">Simulate company income by recording product sales for specific months.</p>
    </div>
    <div class="text-right">
        <p class="text-sm font-medium text-gray-500">Total Company Funds</p>
        <p class="text-2xl font-bold text-green-600">@currentBalance.ToString("C", new System.Globalization.CultureInfo("en-US"))</p>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6" role="alert">
        <p>@TempData["SuccessMessage"]</p>
    </div>
}

<div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Products from Fake Store API</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @foreach (var product in Model)
        {
            <div class="border rounded-lg p-4 flex flex-col">
                <img src="@product.Image" alt="@product.Title" class="h-40 w-full object-contain mb-4" />
                <h4 class="font-semibold text-gray-800 flex-grow">@product.Title</h4>
                <p class="text-lg font-bold text-blue-600 my-2">@product.Price.ToString("C", new System.Globalization.CultureInfo("en-US"))</p>

                <!-- THE FIX: The asp-controller is now correctly set to "UserDashboard" -->
                <form asp-action="RecordSale" asp-controller="UserDashboard" method="post" class="space-y-4">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="productName" value="@product.Title" />
                    <input type="hidden" name="price" value="@product.Price" />

                    <div>
                        <label for="transactionMonth-@product.Id" class="text-sm font-medium text-gray-700">Sale Month</label>
                        <input type="month" id="transactionMonth-@product.Id" name="transactionMonth" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required value="@DateTime.Now.ToString("yyyy-MM")" />
                    </div>

                    <button type="submit" class="w-full bg-blue-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-blue-700">
                        Record Sale
                    </button>
                </form>
            </div>
        }
    </div>
</div>
